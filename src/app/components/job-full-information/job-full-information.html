<div class="jc">
  <div *ngIf="isLoading" class="jc-loading">
    <div class="jc-spinner"></div>
    <p class="jc-loading-text">Loading...</p>
  </div>

  <div *ngIf="!isLoading && job" class="container-fluid px-0">
    <div class="row g-0">
      <div class="col-12 col-md-9 pe-md-1">
        <!-- Breadcrumb / Header -->
        <div class="jc-top-card mb-1">
          <div class="jc-header-row">
            <div class="jc-breadcrumb">
              <i class="bi bi-house-fill"></i>
              <span (click)="goBack()" style="cursor: pointer;">Home</span>
              <i class="bi bi-chevron-right"></i>
              <span class="jc-category-name">{{ job.category }}</span>
            </div>
            <div class="jc-follow-mini">
              <span class="follow-text">Follow:</span>
              <button class="mini-social-btn mini-yt" (click)="openExternalChannel('https://www.youtube.com/@allindajobs')">
                <i class="bi bi-youtube"></i>
              </button>
              <button class="mini-social-btn mini-wa" (click)="openExternalChannel('https://whatsapp.com/channel/0029VbCLJWjCRs1nIKjUlh3p')">
                <i class="bi bi-whatsapp"></i>
              </button>
              <button class="mini-social-btn mini-fb" (click)="openExternalChannel('https://www.facebook.com/share/17yHma5rhP/')">
                <i class="bi bi-facebook"></i>
              </button>
              <button class="mini-social-btn mini-ig" (click)="openExternalChannel('https://www.instagram.com/allindajobs?igsh=MXJxeWl4NXdmeDVtdg==')">
                <i class="bi bi-instagram"></i>
              </button>
            </div>
          </div>
        </div>

        <!-- Main Job Card -->
        <div class="jc-top-card mb-2 p-3">
          <h1 class="job-title-display">{{ job.title }}</h1>
          <div class="job-meta-header mt-2 mb-3">
            <span class="meta-badge"><i class="bi bi-person-circle"></i> Admin</span>
            <span class="meta-badge"><i class="bi bi-calendar-event"></i> {{ formatDate(job.createdDate) }}</span>
            <div class="ms-auto d-flex align-items-center gap-1 gap-md-2">
              <span class="share-label">Share:</span>
              <button class="share-icon-btn wa" (click)="shareOnWhatsApp(job)" title="Share on WhatsApp"><i class="bi bi-whatsapp"></i></button>
              <button class="share-icon-btn share" (click)="shareJob(job)" title="Share Job"><i class="bi bi-share"></i></button>
            </div>
          </div>

          <hr class="jc-filter-divider mb-3">

          <div class="job-description-container">
            <h4 class="info-section-title"><i class="bi bi-file-text-fill"></i> Job Description</h4>
            <div class="job-desc-content">
              <!-- Phase 1 Description Logic -->
              <div *ngIf="isRichText(job.description)" [innerHTML]="getSafeHtml(job.description)"></div>
              <ng-container *ngIf="!isRichText(job.description)">
                <div *ngIf="hasDots(job.description)" class="plain-desc-list">
                  <div *ngFor="let sentence of getDescriptionList(job.description)" class="desc-item">
                    <i class="bi bi-patch-check-fill text-primary"></i>
                  <span class="ms-1">{{ sentence }}</span>
                </div>
              </div>
              <div *ngIf="!hasDots(job.description)" class="plain-desc-text">
                {{ job.description }}
              </div>
            </ng-container>
          </div>
        </div>

          <!-- Official Links Section -->
          <div class="official-links-box mt-4" *ngIf="job.applicationUrl">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-info-circle-fill text-primary me-2"></i>
              <span class="fw-bold">Official Notification / Apply Link:</span>
            </div>
            <a [href]="job.applicationUrl" target="_blank" class="apply-btn-legacy">
              <i class="bi bi-box-arrow-up-right me-2"></i>
              Click here to Apply
            </a>
          </div>

          <!-- Note -->
          <div class="note-box mt-3">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <span><strong>Note:</strong> Before applying for a job, make sure to double-check the job information.</span>
          </div>
        </div>
      </div>

      <!-- Right Column Sidebar -->
      <div class="col-12 col-md-3">
        <!-- Highlights Sidebar Card -->
        <div class="jc-top-card p-3 mb-2">
          <h5 class="sidebar-title mb-3">Quick Highlights</h5>
          <div class="highlight-item mb-2 d-flex justify-content-between align-items-center">
            <small class="text-muted">Company</small>
            <strong class="text-end ms-2">{{ job.company }}</strong>
          </div>
          <div class="highlight-item mb-2 d-flex justify-content-between align-items-center">
            <small class="text-muted">Category</small>
            <strong class="text-end ms-2">{{ job.category }}</strong>
          </div>
          <div class="highlight-item mb-2 d-flex justify-content-between align-items-center">
            <small class="text-muted">Posted On</small>
            <strong class="text-end ms-2">{{ formatDate(job.createdDate) }}</strong>
          </div>
          <div class="highlight-item mb-2 text-danger d-flex justify-content-between align-items-center" *ngIf="job.category === 'Walk-in Drives' && job.walkInStartDate">
            <small class="text-muted">Start Date</small>
            <strong class="text-end ms-2">{{ job.walkInStartDate | date:'dd MMM yyyy' }}</strong>
          </div>
          <div class="highlight-item mb-2 text-danger d-flex justify-content-between align-items-center" *ngIf="job.category === 'Walk-in Drives' && job.walkInEndDate">
            <small class="text-muted">End Date</small>
            <strong class="text-end ms-2">{{ job.walkInEndDate | date:'dd MMM yyyy' }}</strong>
          </div>
          <div class="highlight-item mb-2 text-primary d-flex justify-content-between align-items-center" *ngIf="job.category === 'Government Jobs' && job.lastDateToApply">
            <small class="text-muted">Last Date</small>
            <strong class="text-end ms-2">{{ job.lastDateToApply | date:'dd MMM yyyy' }}</strong>
          </div>

          <div class="sidebar-wa-card mt-3" (click)="openExternalChannel('https://whatsapp.com/channel/0029VbCLJWjCRs1nIKjUlh3p')">
            <div class="d-flex align-items-center">
              <div class="wa-icon-box me-2">
                <i class="bi bi-whatsapp"></i>
              </div>
              <div class="wa-content">
                <span class="wa-title">Join WhatsApp</span>
                <span class="wa-subtitle">Get Instant Job Alerts</span>
              </div>
              <i class="bi bi-arrow-right-short ms-auto"></i>
            </div>
          </div>
        </div>

        <!-- Related Jobs Sidebar -->
        <div class="jc-top-card p-0 overflow-hidden">
          <div class="sidebar-header p-3 pb-0">
            <h5 class="sidebar-title"><i class="bi bi-fire text-danger me-2"></i>Related Jobs</h5>
          </div>
          <div class="jc-jobs" *ngIf="latestJobs && latestJobs.length > 0">
            <div class="jc-job" *ngFor="let latestJob of latestJobs.slice(0, 10); trackBy: trackByJobId" (click)="viewJobDetails(latestJob)">
              <div class="jc-job-info">
                <span class="jc-job-title">
                  <i class="bi bi-chevron-right star-icon"></i>
                  {{ latestJob.title }}
                </span>
                <div class="jc-job-meta">
                  <div class="jc-job-meta-left">
                    <span class="jc-job-cat">{{ latestJob.category }}</span>
                    <span class="jc-sep">|</span>
                    <span class="jc-job-time">{{ getTimeAgo(latestJob.createdDate) }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!isLoading && !job" class="jc-empty">
    <div class="text-center p-5 bg-white rounded shadow-sm">
      <i class="bi bi-search-heart display-1 text-muted mb-4"></i>
      <h3>Oops! Job Not Found</h3>
      <p class="text-muted mb-4">The job posting you are looking for might have been removed or is no longer available.</p>
      <button class="btn btn-primary btn-lg px-4" (click)="goBack()">
        <i class="bi bi-arrow-left me-2"></i>Back to Latest Jobs
      </button>
    </div>
  </div>
</div>
