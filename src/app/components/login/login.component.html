<div class="login-container">
  <!-- Initial Authentication Check Loading -->
  <div *ngIf="isLoading" class="auth-check-loading">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6 text-center">
          <div class="loading-card">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3 mb-0 text-muted">{{ isLoggedIn ? 'Loading dashboard...' : 'Checking authentication status...' }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Login Form -->
  <div *ngIf="!isLoggedIn && !isLoading" class="login-section">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
          <div class="login-card position-relative">
            <!-- Loading Overlay -->
            <div *ngIf="isLoading" class="loading-overlay">
              <div class="spinner-container">
                <div class="spinner-border text-primary" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2 mb-0">Authenticating...</p>
              </div>
            </div>
            
            <div class="text-center mb-4">
              <h2 class="text-primary">Admin Login</h2>
              <p class="text-muted">Access Job Management System</p>
            </div>
            
            <form (ngSubmit)="onLogin()" #loginForm="ngForm">
              <div class="mb-3">
                <label for="email" class="form-label">Email Address</label>
                <input 
                  type="email" 
                  class="form-control" 
                  id="email" 
                  [(ngModel)]="email" 
                  name="email" 
                  required 
                  placeholder="Enter your email">
              </div>
              
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input 
                  type="password" 
                  class="form-control" 
                  id="password" 
                  [(ngModel)]="password" 
                  name="password" 
                  required 
                  placeholder="Enter your password">
              </div>
              
              <div class="alert alert-danger" *ngIf="loginError">
                {{ loginError }}
              </div>
              
              <button type="submit" class="btn btn-primary w-100" [disabled]="!loginForm.valid || isLoading">
                <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                <span *ngIf="isLoading">Logging in...</span>
                <span *ngIf="!isLoading">Login</span>
              </button>
            </form>
            
            <div class="mt-3 text-center">
              <small class="text-muted">Use your registered email and password</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Job Management Dashboard -->
  <div *ngIf="isLoggedIn" class="job-management-section">
    <div class="container-fluid py-4">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h2 class="text-primary mb-0">Job Management System</h2>
          <p class="text-muted mb-0">Welcome, {{ currentUser?.email || currentUser?.displayName }}</p>
        </div>
        <div>
          <button class="btn btn-success me-2" (click)="showCreateForm()">
            <i class="bi bi-plus-circle me-1"></i>Create New Job
          </button>
          <button class="btn btn-info me-2 text-white" (click)="showCareerCreateForm()">
            <i class="bi bi-briefcase me-1"></i>Create Job Careers
          </button>
          <button class="btn btn-outline-danger" (click)="logout()">
            <i class="bi bi-box-arrow-right me-1"></i>Logout
          </button>
        </div>
      </div>

      <!-- Tabs Navigation -->
      <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'jobs'" (click)="activeTab = 'jobs'" href="javascript:void(0)">All Latest Jobs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [class.active]="activeTab === 'careers'" (click)="activeTab = 'careers'" href="javascript:void(0)">All Latest Job Careers</a>
        </li>
      </ul>

      <!-- Career Form Modal -->
      <div *ngIf="showCareerForm" class="job-form-modal">
        <div class="job-form-content">
          <div class="job-form-header">
            <h4 class="mb-0">{{ editingCareer ? 'Edit Job Career' : 'Create New Job Career' }}</h4>
            <button class="btn-close" (click)="cancelCareerForm()"></button>
          </div>
          
          <form (ngSubmit)="saveCareer()" #careerFormRef="ngForm" class="job-form-body">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Company Name *</label>
                <input type="text" class="form-control" [(ngModel)]="careerForm.company" name="company" required placeholder="e.g. Google">
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label">Job Type *</label>
                <select class="form-control" [(ngModel)]="careerForm.jobType" name="jobType" required>
                  <option *ngFor="let type of careerJobTypes" [value]="type">{{ type }}</option>
                </select>
              </div>
              
              <div class="col-12 mb-3">
                <label class="form-label">CareerOfficeURL *</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                  <input type="url" class="form-control" [(ngModel)]="careerForm.careerOfficeUrl" name="careerOfficeUrl" required placeholder="https://google.com/careers">
                </div>
              </div>
            </div>
            
            <div class="job-form-footer">
              <button type="button" class="btn btn-secondary me-2" (click)="cancelCareerForm()" [disabled]="isSaving">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="!careerFormRef.valid || isSaving">
                <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                <span *ngIf="isSaving">{{ editingCareer ? 'Updating...' : 'Creating...' }}</span>
                <span *ngIf="!isSaving">{{ editingCareer ? 'Save Career' : 'Create Career' }}</span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Job Form Modal -->
      <div *ngIf="showJobForm" class="job-form-modal">
        <div class="job-form-content">
          <div class="job-form-header">
            <h4 class="mb-0">{{ editingJob ? 'Edit Job' : 'Create New Job' }}</h4>
            <button class="btn-close" (click)="cancelJobForm()"></button>
          </div>
          
          <form (ngSubmit)="saveJob()" #jobFormRef="ngForm" class="job-form-body">
            <div class="row">
              <!-- Basic Info - 3 Columns for compact view -->
              <div class="col-md-4 mb-3">
                <label class="form-label">Job Title *</label>
                <input type="text" class="form-control" [(ngModel)]="jobForm.title" name="title" required placeholder="e.g. Software Engineer">
              </div>
              
              <div class="col-md-4 mb-3" *ngIf="jobForm.category !== 'Health and Career Tips' && jobForm.category !== 'Motivation Stories'">
                <label class="form-label">Company Name</label>
                <input type="text" class="form-control" [(ngModel)]="jobForm.company" name="company" placeholder="e.g. Tech Solutions">
              </div>
              
              <div class="col-md-4 mb-3">
                <label class="form-label">Job Category *</label>
                <select class="form-control" [(ngModel)]="jobForm.category" name="category" required>
                  <option *ngFor="let category of jobCategories" [value]="category">{{ category }}</option>
                </select>
              </div>

              

              <div class="col-md-4 mb-3" *ngIf="jobForm.category !== 'Government Jobs' && jobForm.category !== 'Health and Career Tips' && jobForm.category !== 'Motivation Stories'">
                <label class="form-label">Experience *</label>
                <select class="form-control" [(ngModel)]="jobForm.experience" name="experience" required>
                  <option *ngFor="let opt of experienceOptions" [value]="opt">{{ opt }}</option>
                </select>
              </div>

              <div class="col-md-4 mb-3" *ngIf="editingJob && jobForm.category !== 'Health and Career Tips' && jobForm.category !== 'Motivation Stories'">
                <label class="form-label">Created Date & Time *</label>
                <input type="datetime-local" class="form-control" [(ngModel)]="jobForm.createdDate" name="createdDate" required>
              </div>

              <!-- Conditional Fields - also responsive -->
              <ng-container *ngIf="jobForm.category === 'Walk-in Drives'">
                <div class="col-md-4 mb-3">
                  <label class="form-label text-danger">Walk-in Start Date *</label>
                  <input type="date" class="form-control border-danger" [(ngModel)]="jobForm.walkInStartDate" name="walkInStartDate" required>
                </div>
                <div class="col-md-4 mb-3">
                  <label class="form-label text-danger">Walk-in End Date *</label>
                  <input type="date" class="form-control border-danger" [(ngModel)]="jobForm.walkInEndDate" name="walkInEndDate" required>
                </div>
              </ng-container>

              <ng-container *ngIf="jobForm.category === 'Government Jobs'">
                <div class="col-md-4 mb-3">
                  <label class="form-label text-primary">Last Date to Apply *</label>
                  <input type="date" class="form-control border-primary" [(ngModel)]="jobForm.lastDateToApply" name="lastDateToApply" required>
                </div>
              </ng-container>

              <!-- Application URL - Full Row for visibility -->
              <div class="col-12 mb-3" *ngIf="jobForm.category !== 'Health and Career Tips' && jobForm.category !== 'Motivation Stories'">
                <label class="form-label">Application URL (Registration Link)</label>
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-link-45deg"></i></span>
                  <input type="url" class="form-control" [(ngModel)]="jobForm.applicationUrl" name="applicationUrl" placeholder="https://example.com/apply">
                </div>
              </div>
              <!-- Description - Full Row -->
              <div class="col-12 ">
                <label class="form-label d-flex justify-content-between">
                  <span>Job Description *</span>
            
                </label>
                <quill-editor 
                  [(ngModel)]="jobForm.description" 
                  name="description" 
                  [modules]="quillModules"
                  [styles]="{height: '350px'}"
                  placeholder="Detailed job description..."
                  required>
                </quill-editor>
              </div>
            </div>
            
            <div class="job-form-footer">
              <button type="button" class="btn btn-secondary me-2" (click)="cancelJobForm()" [disabled]="isSaving">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="!jobFormRef.valid || isSaving">
                <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                <span *ngIf="isSaving">{{ editingJob ? 'Updating...' : 'Creating...' }}</span>
                <span *ngIf="!isSaving">{{ editingJob ? 'Update Job' : 'Create Job' }}</span>
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Jobs List (Tab 1) -->
      <div class="jobs-section" *ngIf="activeTab === 'jobs'">
        <div class="jobs-header mb-3 d-flex justify-content-between align-items-center">
          <h4 class="text-primary mb-0">All Jobs ({{ jobs.length }})</h4>
          <small class="text-muted">Compact View</small>
        </div>
        
        <div class="row" *ngIf="jobs.length > 0">
          <div class="col-12 mb-3" *ngFor="let job of jobs">
            <div class="job-card-compact" [class.expanded]="isJobExpanded(job.id)">
              <div class="job-header-compact" (click)="toggleJobExpand(job.id)" style="cursor: pointer;">
                <div class="job-info">
                  <div class="d-flex align-items-center gap-2">
                    <i class="bi" [class.bi-chevron-right]="!isJobExpanded(job.id)" [class.bi-chevron-down]="isJobExpanded(job.id)"></i>
                    <div>
                      <h6 class="job-title-small mb-0">{{ job.title }}</h6>
                      <small class="job-company-small text-muted">
                        <i class="bi bi-building me-1"></i>{{ job.company }} â€¢ 
                        <span class="badge bg-primary badge-sm">{{ job.category }}</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="job-actions-small" (click)="$event.stopPropagation()">
                  <button class="btn btn-sm btn-success me-1" (click)="shareJobOnWhatsApp(job)" title="Share on WhatsApp">
                    <i class="bi bi-whatsapp"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-primary me-1" (click)="editJob(job)" title="Edit">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="deleteJob(job.id)" title="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              
              <div class="job-body-compact" *ngIf="isJobExpanded(job.id)">
                <div class="job-meta-info mb-2">
                  <small class="text-muted me-3"><i class="bi bi-calendar3 me-1"></i>Posted: {{ job.createdDate | date:'yyyy-MM-dd HH:mm' }}</small>
                  <small class="text-muted"><i class="bi bi-telephone me-1"></i>{{ job.contactInfo }}</small>
                </div>
                <div class="job-desc-small" [innerHTML]="job.description"></div>
                <div *ngIf="job.applicationUrl" class="mt-3">
                  <a [href]="job.applicationUrl" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-link-45deg me-1"></i>Open Application Link
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="jobs.length === 0" class="text-center py-4">
          <i class="bi bi-inbox display-4 text-muted"></i>
          <h5 class="mt-3 text-muted">No Jobs Available</h5>
          <p class="text-muted">Create your first job posting to get started.</p>
        </div>
      </div>

      <!-- Job Careers List (Tab 2) -->
      <div class="jobs-section" *ngIf="activeTab === 'careers'">
        <div class="jobs-header mb-3 d-flex justify-content-between align-items-center">
          <h4 class="text-primary mb-0">Job Careers ({{ jobCareers.length }})</h4>
        </div>
        
        <div class="row" *ngIf="jobCareers.length > 0">
          <div class="col-12 mb-3" *ngFor="let career of jobCareers">
            <div class="job-card-compact" [class.expanded]="isCareerExpanded(career.id)">
              <div class="job-header-compact" (click)="toggleCareerExpand(career.id)" style="cursor: pointer;">
                <div class="job-info">
                  <div class="d-flex align-items-center gap-2">
                    <i class="bi" [class.bi-chevron-right]="!isCareerExpanded(career.id)" [class.bi-chevron-down]="isCareerExpanded(career.id)"></i>
                    <div>
                      <h6 class="job-title-small mb-0">{{ career.company }}</h6>
                      <small class="job-company-small text-muted">
                        <span class="badge bg-info text-white badge-sm">{{ career.jobType }}</span>
                      </small>
                    </div>
                  </div>
                </div>
                <div class="job-actions-small" (click)="$event.stopPropagation()">
                  <button class="btn btn-sm btn-outline-primary me-1" (click)="editCareer(career)" title="Edit">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" (click)="deleteCareer(career.id)" title="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
              
              <div class="job-body-compact" *ngIf="isCareerExpanded(career.id)">
                <div class="job-meta-info mb-2">
                  <div class="mb-2"><strong>Company:</strong> {{ career.company }}</div>
                  <div class="mb-2"><strong>Job Type:</strong> {{ career.jobType }}</div>
                  <div class="mb-2">
                    <strong>CareerOfficeURL:</strong> 
                    <a [href]="career.careerOfficeUrl" target="_blank" class="ms-1">{{ career.careerOfficeUrl }}</a>
                  </div>
                  <small class="text-muted"><i class="bi bi-calendar3 me-1"></i>Added: {{ career.createdDate | date:'yyyy-MM-dd HH:mm' }}</small>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div *ngIf="jobCareers.length === 0" class="text-center py-4">
          <i class="bi bi-briefcase display-4 text-muted"></i>
          <h5 class="mt-3 text-muted">No Career Links Available</h5>
          <p class="text-muted">Add your first job career link to get started.</p>
        </div>
      </div>
    </div>
  </div>
</div>
